version: '1.0'
name: ci
displayName: ci
triggers:
  trigger: auto
  pr:
    branches:
      precise:
        - main
  push:
    branches:
      precise:
        - main

stages:
  - name: build_and_test 
    displayName: build_and_test
    strategy: fast
    trigger: auto
    executor: []
    steps:
      - step: build@gcc
        name: build
        displayName: Run S7 SRFI tests
        gccVersion: '9.4'
        commands:
          - wget -O /tmp/s7 https://gitee.com/XmacsLabs/s7-scheme-binary/releases/download/v20230413.4/s7_ubuntu_focal
          - sha256sum /tmp/s7 | grep 871c6e351b51a87eece7aa8051f88917762c3d4c3798a3818dd752235e119d97
          - chmod +x /tmp/s7
          - cd srfi
          - ls *test.scm | xargs -I% /tmp/s7 %
        caches: []
        notify: []
        strategy:
          retry: '0'
          stepTimeout: 30
